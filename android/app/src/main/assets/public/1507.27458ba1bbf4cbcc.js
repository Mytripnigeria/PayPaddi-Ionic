"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1507],{1507:(Y,_,c)=>{c.d(_,{e:()=>J});var s=c(655),l=c(4182),e=c(2096),a=c(8779),v=c(649),Z=c(7913),x=c(9244),d=c(6953),h=c(6388),g=c(9709);const f="stored-images";let y=(()=>{class i{constructor(t,o){this.plt=t,this.userService=o,this.imageFile=[],this.base64=null,this.convertBlobToBase64=r=>new Promise((u,p)=>{const m=new FileReader;m.onerror=p,m.onload=()=>{u(m.result)},m.readAsDataURL(r)})}selectImage(){return(0,s.mG)(this,void 0,void 0,function*(){const t=yield h.V1.getPhoto({quality:90,allowEditing:!1,resultType:h.dk.Uri,source:h.oK.Photos});if(t)return yield this.saveImage(t),{image:yield this.loadImage(),base64:this.base64}})}saveImage(t){return(0,s.mG)(this,void 0,void 0,function*(){const o=yield this.convertPhotoToBase64(t);this.base64=o,console.log("base64 data",o);const r=(new Date).getTime()+".jpg";yield d.fy.writeFile({directory:d.tP.Data,path:`${f}/${r}`,data:o})})}saveImage2(t){return(0,s.mG)(this,void 0,void 0,function*(){const o=(new Date).getTime()+".jpg";yield d.fy.writeFile({directory:d.tP.Data,path:`${f}/${o}`,data:t})})}convertPhotoToBase64(t){return(0,s.mG)(this,void 0,void 0,function*(){if(this.plt.is("hybrid"))return(yield d.fy.readFile({path:t.path})).data;{const r=yield(yield fetch(t.webPath)).blob();return yield this.convertBlobToBase64(r)}})}loadImage(){return(0,s.mG)(this,void 0,void 0,function*(){return this.imageFile=[],yield d.fy.readdir({directory:d.tP.Data,path:f}).then(t=>(0,s.mG)(this,void 0,void 0,function*(){}),t=>(0,s.mG)(this,void 0,void 0,function*(){yield d.fy.mkdir({directory:d.tP.Data,path:f})}))})}loadImageData(t){return(0,s.mG)(this,void 0,void 0,function*(){for(let o of t){const r=`${f}/${o}`,u=yield d.fy.readFile({directory:d.tP.Data,path:r});return this.imageFile.push({name:o,path:r,data:`data:image/jpeg;base64,${u.data}`}),this.imageFile}})}uploadImage(t){return(0,s.mG)(this,void 0,void 0,function*(){const r=yield(yield fetch(t.data)).blob(),u=new FormData;return u.append("file",r,t.name),u.forEach(p=>{console.log(p)}),yield this.userService.updateProfilePicture(u)})}deleteFile(t){return(0,s.mG)(this,void 0,void 0,function*(){yield d.fy.deleteFile({directory:d.tP.Data,path:t.path})})}dowloadFile(t){return(0,s.mG)(this,void 0,void 0,function*(){var o=window.URL.createObjectURL(t);window.open(o)})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(a.t4),e.LFG(g.K))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var b=c(9808);function T(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"ion-buttons",8)(1,"form",9),e.NdJ("ngSubmit",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.submit())}),e.TgZ(2,"ion-button",10),e._uU(3," Done "),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("formGroup",t.edit_profile_form),e.xp6(1),e.Q6J("disabled",t.edit_profile_form.invalid)}}function I(i,n){1&i&&e._UZ(0,"ion-icon",15)}function U(i,n){if(1&i&&e._UZ(0,"img",16),2&i){const t=e.oxw(2);e.Q6J("src",t.userData.picture,e.LSH)}}function P(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",11)(1,"ion-avatar"),e.YNc(2,I,1,0,"ion-icon",12),e.YNc(3,U,1,1,"img",13),e.qZA(),e.TgZ(4,"ion-button",14),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.updateProfilePicture())}),e._uU(5," Update profile picture "),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!t.userData.picture||""===t.userData.picture),e.xp6(1),e.Q6J("ngIf",t.userData.picture)}}function q(i,n){1&i&&(e.TgZ(0,"ion-text",31)(1,"small",32),e._uU(2,"Firstname is required."),e.qZA()())}function A(i,n){1&i&&(e.TgZ(0,"ion-text",31)(1,"small",32),e._uU(2,"Middlename is required."),e.qZA()())}function D(i,n){1&i&&(e.TgZ(0,"ion-text",31)(1,"small",32),e._uU(2,"Lastname is required."),e.qZA()())}function S(i,n){1&i&&(e.TgZ(0,"ion-text",31)(1,"small",32),e._uU(2,"Username is required."),e.qZA()())}function E(i,n){1&i&&(e.TgZ(0,"ion-text",31)(1,"small",32),e._uU(2,"Gender is required."),e.qZA()())}function F(i,n){1&i&&(e.TgZ(0,"ion-text",31)(1,"small",32),e._uU(2,"Address is required."),e.qZA()())}function G(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"form",17),e.NdJ("submit",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.submit())}),e.TgZ(1,"ion-list",18)(2,"ion-item")(3,"ion-label",19),e._uU(4,"First name"),e.qZA(),e._UZ(5,"ion-input",20),e.qZA(),e.YNc(6,q,3,0,"ion-text",21),e.TgZ(7,"ion-item")(8,"ion-label",19),e._uU(9,"Middlename"),e.qZA(),e._UZ(10,"ion-input",22),e.qZA(),e.YNc(11,A,3,0,"ion-text",21),e.TgZ(12,"ion-item")(13,"ion-label",19),e._uU(14,"Last name"),e.qZA(),e._UZ(15,"ion-input",23),e.qZA(),e.YNc(16,D,3,0,"ion-text",21),e.TgZ(17,"ion-item")(18,"ion-label",19),e._uU(19,"Username"),e.qZA(),e._UZ(20,"ion-input",24),e.qZA(),e.YNc(21,S,3,0,"ion-text",21),e.TgZ(22,"ion-item")(23,"ion-label",19),e._uU(24,"Gender"),e.qZA(),e.TgZ(25,"ion-select",25)(26,"ion-select-option",26),e._uU(27,"Male"),e.qZA(),e.TgZ(28,"ion-select-option",27),e._uU(29,"Female"),e.qZA()()(),e.YNc(30,E,3,0,"ion-text",21),e.TgZ(31,"ion-item")(32,"ion-label",19),e._uU(33,"Phone Number"),e.qZA(),e._UZ(34,"ion-input",28),e.qZA(),e.TgZ(35,"ion-item")(36,"ion-label",19),e._uU(37,"Email Address"),e.qZA(),e._UZ(38,"ion-input",29),e.qZA(),e.TgZ(39,"ion-item")(40,"ion-label",19),e._uU(41,"Address"),e.qZA(),e._UZ(42,"ion-input",30),e.qZA(),e.YNc(43,F,3,0,"ion-text",21),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("formGroup",t.edit_profile_form),e.xp6(6),e.Q6J("ngIf",t.edit_profile_form.controls.firstname.errors&&t.edit_profile_form.controls.firstname.errors.required&&t.edit_profile_form.controls.firstname.touched),e.xp6(5),e.Q6J("ngIf",t.edit_profile_form.controls.middlename.errors&&t.edit_profile_form.controls.middlename.errors.required&&t.edit_profile_form.controls.middlename.touched),e.xp6(5),e.Q6J("ngIf",t.edit_profile_form.controls.lastname.errors&&t.edit_profile_form.controls.lastname.errors.required&&t.edit_profile_form.controls.lastname.touched),e.xp6(4),e.Q6J("readonly",!0),e.xp6(1),e.Q6J("ngIf",t.edit_profile_form.controls.username.errors&&t.edit_profile_form.controls.username.errors.required&&t.edit_profile_form.controls.username.touched),e.xp6(4),e.Q6J("value",t.userData.gender),e.xp6(5),e.Q6J("ngIf",t.edit_profile_form.controls.gender.errors&&t.edit_profile_form.controls.gender.errors.required&&t.edit_profile_form.controls.gender.touched),e.xp6(4),e.Q6J("readonly",!0),e.xp6(4),e.Q6J("readonly",!0),e.xp6(5),e.Q6J("ngIf",t.edit_profile_form.controls.address.errors&&t.edit_profile_form.controls.address.errors.required&&t.edit_profile_form.controls.address.touched)}}let J=(()=>{class i{constructor(t,o,r,u,p,m,N,C,Q){this.formBuilder=t,this.modalController=o,this.toastService=r,this.navController=u,this.util=p,this.dataService=m,this.cameraService=N,this.userService=C,this.actionSheetController=Q,this.update=!1,this.submit_attempt=!1,this.userData=null}ngOnInit(){}ionViewWillEnter(){this.update=this.dataService.getParams(),this.userData=this.dataService.getUserProfile(),this.edit_profile_form=this.formBuilder.group({firstname:[this.userData.firstname,l.kI.required],lastname:[this.userData.lastname,l.kI.required],username:[this.userData.username,l.kI.required],email:[this.userData.email,l.kI.required],phone:[this.userData.phone,l.kI.required],middlename:[this.userData.middlename,l.kI.required],address:[this.userData.address,l.kI.required],gender:[this.userData.gender,l.kI.required]})}updateProfilePicture(){return(0,s.mG)(this,void 0,void 0,function*(){yield(yield this.actionSheetController.create({header:"Choose existing picture or take new",cssClass:"custom-action-sheet",buttons:[{text:"Choose from gallery",icon:"images",handler:()=>(0,s.mG)(this,void 0,void 0,function*(){const{image:o,base64:r}=yield this.cameraService.selectImage();this.userData.picture=r,console.log(o[0]),this.uploadImage(o[0])})},{text:"Take picture",icon:"camera",handler:()=>{}},{text:"Cancel",icon:"close",role:"cancel"}]})).present()})}back(){this.update&&this.modalController.dismiss()}submit(){return(0,s.mG)(this,void 0,void 0,function*(){if(this.submit_attempt=!0,this.edit_profile_form.valid){const t=yield this.util.loader("Updating");t.present();const o=yield this.userService.updateProfile(this.edit_profile_form.value);t.dismiss(),o.error?this.toastService.presentToast("Error","top","danger","Unable to update profile",2e3):(console.log(o),yield this.dataService.commitUser(),this.toastService.presentToast("Success","top","success","Profile saved",2e3),this.update?this.modalController.dismiss({updated:!0}):this.navController.navigateBack(["/settings"]))}else this.toastService.presentToast("Error","top","danger","Please fill in all required fields",2e3)})}uploadImage(t){return(0,s.mG)(this,void 0,void 0,function*(){const o=yield this.util.loader("Uploading Image...");o.present();const r=yield this.cameraService.uploadImage(t);o.dismiss(),r.result?r.result.data.error?this.toastService.presentToast("Error","top","danger","Unable to upload Image",2e3):(this.userData.picture=t.data,this.toastService.presentToast("Success","top","success","Uploaded successfully",2e3)):this.toastService.presentToast("Error","top","danger","Unable to upload Image",2e3),console.log("Upload result==>",r)})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(l.qu),e.Y36(a.IN),e.Y36(v.k),e.Y36(a.SH),e.Y36(Z.t),e.Y36(x.D),e.Y36(y),e.Y36(g.K),e.Y36(a.BX))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-edit"]],decls:11,vars:5,consts:[["collapse","fade",3,"translucent"],["slot","start",3,"click"],["text","Settings","defaultHref","/settings"],["slot","end",4,"ngIf"],[3,"fullscreen"],["class","hero hero-light-gradient",4,"ngIf"],[1,"ion-padding"],["class","form-default",3,"formGroup","submit",4,"ngIf"],["slot","end"],[1,"form-default",3,"formGroup","ngSubmit"],["type","submit",3,"disabled"],[1,"hero","hero-light-gradient"],["class","avatar-icon-placeholder","name","person-circle","color","tertiary",4,"ngIf"],["alt","",3,"src",4,"ngIf"],["color","primary","fill","clear",1,"ion-button-small",3,"click"],["name","person-circle","color","tertiary",1,"avatar-icon-placeholder"],["alt","",3,"src"],[1,"form-default",3,"formGroup","submit"],["lines","none",1,"item-card-list"],["color","tertiary","position","stacked"],["formControlName","firstname","placeholder","First name"],["color","danger",4,"ngIf"],["formControlName","middlename","placeholder","Middlename"],["formControlName","lastname","placeholder","Last name"],["formControlName","username","placeholder","Username",3,"readonly"],["formControlName","gender",3,"value"],["value","Male"],["value","Female"],["formControlName","phone","placeholder","Phone Number",3,"readonly"],["formControlName","email","placeholder","Email Address",3,"readonly"],["formControlName","address","placeholder","Address"],["color","danger"],[1,"error-message-form"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.NdJ("click",function(){return o.back()}),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5," Profile "),e.qZA(),e.YNc(6,T,4,2,"ion-buttons",3),e.qZA()(),e.TgZ(7,"ion-content",4),e.YNc(8,P,6,2,"div",5),e.TgZ(9,"div",6),e.YNc(10,G,44,11,"form",7),e.qZA()()),2&t&&(e.Q6J("translucent",!0),e.xp6(6),e.Q6J("ngIf",o.userData),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(1),e.Q6J("ngIf",o.userData),e.xp6(2),e.Q6J("ngIf",o.userData))},dependencies:[b.O5,l._Y,l.JJ,l.JL,a.BJ,a.oU,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.pK,a.Ie,a.Q$,a.q_,a.t9,a.n0,a.yW,a.wd,a.sr,a.QI,a.j9,a.cs,l.sg,l.u]}),i})()}}]);